<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>WASM: Ses -> Video DÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼</title>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <style>
        body { background: #121212; color: #ddd; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .box { background: #1e1e1e; padding: 20px; border-radius: 10px; border: 1px solid #333; max-width: 600px; width: 100%; text-align: center; }
        button { background: #E1306C; color: white; border: none; padding: 12px 24px; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 15px; font-size: 1rem; }
        button:disabled { background: #555; cursor: not-allowed; }
        button:hover:not(:disabled) { background: #C13584; }
        input { margin: 15px 0; }
        #log { margin-top: 15px; font-family: monospace; font-size: 0.8rem; color: #00ff9d; white-space: pre-wrap; height: 150px; overflow-y: scroll; background: #000; padding: 10px; text-align: left; }
        video { margin-top: 20px; max-width: 100%; border: 2px solid #333; }
    </style>
</head>
<body>

    <div class="box">
        <h1>ğŸµ Sesi Videoya Ã‡evir (WASM)</h1>
        <p>FFmpeg.wasm kullanarak tarayÄ±cÄ±da MP3'Ã¼ MP4 yap.</p>

        <input type="file" id="uploader" accept="audio/*">
        <br>
        <button id="convertBtn" onclick="convertToVideo()">VÄ°DEO OLUÅTUR</button>

        <div id="log">Sistem HazÄ±rlanÄ±yor...</div>
        
        <video id="outputVideo" controls></video>
        <br>
        <a id="downloadLink" style="display:none; color: #E1306C; margin-top:10px;">Videoyu Ä°ndir</a>
    </div>

    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        
        const ffmpeg = createFFmpeg({ log: true });

        const logDiv = document.getElementById('log');
        const convertBtn = document.getElementById('convertBtn');

        function log(message) {
            logDiv.innerHTML += message + "\n";
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        async function loadFFmpeg() {
            log("FFmpeg.wasm yÃ¼kleniyor (25MB)...");
            try {
                await ffmpeg.load();
                log("âœ… FFmpeg hazÄ±r!");
            } catch (e) {
                log("âŒ HATA: FFmpeg yÃ¼klenemedi. SayfayÄ± 'localhost' veya HTTPS sunucuda aÃ§tÄ±ÄŸÄ±nÄ±zdan emin olun.\nDetay: " + e.message);
                convertBtn.disabled = true;
            }
        }
        
        loadFFmpeg();

        async function convertToVideo() {
            const files = document.getElementById('uploader').files;
            if (files.length === 0) {
                alert("LÃ¼tfen bir ses dosyasÄ± seÃ§in.");
                return;
            }

            const file = files[0];
            const fileName = "input.mp3";

            convertBtn.disabled = true;
            convertBtn.innerText = "Ä°ÅŸleniyor...";
            log("--- Ä°ÅŸlem BaÅŸladÄ± ---");

            try {
                ffmpeg.FS('writeFile', fileName, await fetchFile(file));
                log("Dosya hafÄ±zaya alÄ±ndÄ±.");
                log("Video render ediliyor (Bu iÅŸlem iÅŸlemci hÄ±zÄ±na gÃ¶re zaman alÄ±r)...");
                
                await ffmpeg.run(
                    '-f', 'lavfi', 
                    '-i', 'color=c=black:s=1080x1920:r=30',
                    '-i', fileName,
                    '-c:v', 'libx264',
                    '-preset', 'ultrafast',
                    '-tune', 'stillimage',
                    '-c:a', 'aac',
                    '-pix_fmt', 'yuv420p',
                    '-shortest',
                    'output.mp4'
                );

                log("âœ… DÃ¶nÃ¼ÅŸtÃ¼rme tamamlandÄ±!");
                const data = ffmpeg.FS('readFile', 'output.mp4');

                const videoUrl = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));
                const videoEl = document.getElementById('outputVideo');
                videoEl.src = videoUrl;
                
                const dlLink = document.getElementById('downloadLink');
                dlLink.href = videoUrl;
                dlLink.download = "instagram_story.mp4";
                dlLink.style.display = "block";
                dlLink.innerText = "ğŸ“¥ Videoyu Ä°ndir";

            } catch (error) {
                log("âŒ HATA OLUÅTU: " + error);
                console.error(error);
            } finally {
                convertBtn.disabled = false;
                convertBtn.innerText = "VÄ°DEO OLUÅTUR";
            }
        }
    </script>
</body>
</html>
