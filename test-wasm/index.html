<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="background:#000; color:#fff; text-align:center;">
    <h2>C++ WASM Video Player</h2>
    <canvas id="vCanvas" width="640" height="360" style="border:1px solid #444;"></canvas>
    <p id="status">Yükleniyor...</p>

    <script>
        var Module = {
            onRuntimeInitialized: function() {
                console.log("WASM Yüklendi ve Hazır!");
                try {
                    // C++'tan verileri al
                    const ptr = Module._get_video_data();
                    const size = Module._get_video_size();
                    
                    // WASM Belleğine eriş (En standart yol)
                    const videoData = new Uint8Array(Module.HEAPU8.buffer, ptr, size);
                    
                    const blob = new Blob([videoData], { type: 'video/mp4' });
                    const url = URL.createObjectURL(blob);
                    
                    const v = document.createElement('video');
                    v.src = url;
                    v.loop = true; v.muted = true;
                    v.setAttribute('playsinline', '');
                    v.play();

                    const canvas = document.getElementById('vCanvas');
                    const ctx = canvas.getContext('2d');

                    function render() {
                        ctx.drawImage(v, 0, 0, canvas.width, canvas.height);
                        requestAnimationFrame(render);
                    }

                    v.onplay = () => {
                        document.getElementById('status').innerText = "Video Oynatılıyor!";
                        render();
                    };
                } catch (err) {
                    document.getElementById('status').innerText = "Hata: " + err.message;
                    console.error(err);
                }
            }
        };
    </script>
    <!-- JS dosyasını Module tanımlandıktan SONRA yüklüyoruz -->
    <script src="index.js"></script>
</body>
</html>
